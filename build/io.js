modulex.add("io",["util","dom","querystring","promise","url"],function(e,t,r){var n,o,a,i,s,c,u,d,p,l,f,m,v,h=e("util"),y=e("dom"),g=e("querystring"),x=e("promise"),b=e("url");n=function(e){function t(e){return e.replace(c,"\r\n")}function r(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}var n,o=h,a=y,i=g,s=/^(?:select|textarea)/i,c=/\r?\n/g,u=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return n={serialize:function(e,t){return i.stringify(n.getFormData(e),void 0,void 0,t||!1)},getFormData:function(e){var n=[],i={};return o.each(a.query(e),function(e){var t=e.elements?r(e.elements):[e];n.push.apply(n,t)}),n=o.filter(n,function(e){return e.name&&!e.disabled&&(e.checked||s.test(e.nodeName)||u.test(e.type))}),o.each(n,function(e){var r,n=a.val(e);if(null!==n){if(n=o.isArray(n)?o.map(n,t):t(n),r=i[e.name],void 0===r)return i[e.name]=n,void 0;o.isArray(r)||(r=i[e.name]=[r]),r.push.apply(r,o.makeArray(n))}}),i}},e=n}(),o=function(e){function t(e){var t=e.context;delete e.context,e=n.mix(n.clone(v),e,{deep:!0}),e.context=t||e;var r,a,s=e.type,u=e.dataType;return a=e.uri=i.parse(i.resolve(p,e.url),!0),a.query={},"crossDomain"in e||(e.crossDomain=!(a.protocol===l.protocol&&a.host===l.host)),s=e.type=s.toUpperCase(),e.hasContent=!d.test(s),e.processData&&(r=e.data)&&"string"!=typeof r&&(e.data=o.stringify(r,void 0,void 0,e.serializeArray)),u=e.dataType=n.trim(u||"*").split(c),"cache"in e||!n.inArray(u[0],["script","jsonp"])||(e.cache=!1),e.hasContent||(e.data&&n.mix(a.query,o.parse(e.data)),e.cache===!1&&(a.query._ksTS=n.now()+"_"+n.guid())),e}function r(e){var o=this;if(!(o instanceof r))return new r(e);r.superclass.constructor.call(o),a.Defer(o),o.userConfig=e,e=t(e),n.mix(o,{responseData:null,config:e||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});var i,s;r.callPreprocessors("start",{io:o}),r.fire("start",{io:o}),i=m[e.dataType[0]]||m["*"],s=new i(o),o.transport=s,e.contentType&&o.setRequestHeader("Content-Type",e.contentType);var c,u=e.dataType[0],d=e.timeout,p=e.context,l=e.headers,f=e.accepts;o.setRequestHeader("Accept",u&&f[u]?f[u]+("*"===u?"":", */*; q=0.01"):f["*"]);for(c in l)o.setRequestHeader(c,l[c]);if(e.beforeSend&&e.beforeSend.call(p,o,e)===!1)return o;o.readyState=1,r.callPreprocessors("send",{io:o}),r.fire("send",{io:o}),e.async&&d>0&&(o.timeoutTimer=setTimeout(function(){o.abort("timeout")},1e3*d));try{o.state=1,s.send()}catch(v){o.state<2&&o._ioReady(-1,v.message||"send error")}return o}var n=h,o=g,a=x,i=b,s=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,c=/\s+/,u=function(e){return e},d=/^(?:GET|HEAD)$/,p=location.href,l=i.parse(p),f=s.test(l.protocol),m={},v={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:n.parseJson,html:u,text:u,xml:n.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};v.converters.html=v.converters.text;var y={},T={};return n.mix(r,{preprocessors:y,events:T,addPreprocessor:function(e,t){var n=y[e]=y[e]||[];return n.push(t),r},callPreprocessors:function(e,t){for(var n=(y[e]||[]).concat(),o=0,a=n.length;a>o;o++)n[o].call(r,t)},on:function(e,t){var n=T[e]=T[e]||[];return n.push(t),r},detach:function(e,t){if(t){var r=T[e];if(r){var o=n.indexOf(t,r);-1!==o&&r.splice(o,1)}}else T[e]=[]},fire:function(e,t){var n=(T[e]||[]).concat();t=t||{},t.type=e,t.target=t.currentTarget=r;for(var o=0,a=n.length;a>o;o++)n[o].call(r,t)},isLocal:f,setupConfig:function(e){n.mix(v,e,{deep:!0})},setupTransport:function(e,t){m[e]=t},getTransport:function(e){return m[e]},getConfig:function(){return v}}),e=r}(),v=function(e){function t(e,t,r){e.addEventListener?e.addEventListener(t,r,!1):e.attachEvent&&e.attachEvent("on"+t,r)}function r(e,t,r){e.removeEventListener?e.removeEventListener(t,r,!1):e.detachEvent&&e.detachEvent("on"+t,r)}function n(e){var t=0;return parseFloat(e.replace(/\./g,function(){return 0===t++?".":""}))}var o,a,i={addEvent:t,removeEvent:r},s=(window.navigator||{}).userAgent||"";return(o=s.match(/MSIE ([^;]*)|Trident.*; rv(?:\s|:)?([0-9.]+)/))&&(a=o[1]||o[2])&&(i.ie=n(a),i.ieMode=document.documentMode||i.ie),e=i}(),a=function(e){function t(e,t,r){if(!p){p=!0;var n='<object id="'+u+'" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0"><param name="movie" value="'+e+'" /><param name="FlashVars" value="yid='+t+"&uid="+r+"&host="+l+'" /><param name="allowScriptAccess" value="always" /></object>',o=d.createElement("div");s.prepend(o,d.body||d.documentElement),o.innerHTML=n}}function r(e){this.io=e}var n,a=h,i=o,s=y,c={},u="io_swf",d=document,p=!1,l=a.guid("IO"+ +new Date);return window[l]=i,a.augment(r,{send:function(){var e=this,r=e.io,o=r.config,s=o.xdr||{};return s.src||(s.src=i._swf),t(s.src,1,1),n?(e._uid=a.guid(),c[e._uid]=e,n.send(r._getUrlForSend(),{id:e._uid,uid:e._uid,method:o.type,data:o.hasContent&&o.data||{}}),void 0):(setTimeout(function(){e.send()},200),void 0)},abort:function(){n.abort(this._uid)},_xdrResponse:function(e,t){var r,n,o=this,a=t.id,i=t.c,s=o.io;switch(i&&(n=i.responseText)&&(s.responseText=decodeURI(n)),e){case"success":r={status:200,statusText:"success"},delete c[a];break;case"abort":delete c[a];break;case"timeout":case"transport error":case"failure":delete c[a],r={status:"status"in i?i.status:500,statusText:i.statusText||e}}r&&s._ioReady(r.status,r.statusText)}}),i.applyTo=function(e,t,r){var n=t.split(".").slice(1),o=i;a.each(n,function(e){o=o[e]}),o.apply(null,r)},i.xdrReady=function(){n=d.getElementById(u)},i.xdrResponse=function(e,t){var r=c[t.uid];r&&r._xdrResponse(e,t)},e=r}(),i=function(t){function r(e){var t=e.config,r=this;return t.crossDomain?(r.io=e,r):new(a.getTransport("*"))(e)}var n=h,a=o,i=200,s=500;return a.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){return n.globalEval(e),e}}}}),n.augment(r,{send:function(){var t=this,r=t.io,n=r.config;t.script=e.load(r._getUrlForSend(),{charset:n.scriptCharset,success:function(){t._callback("success")},error:function(){t._callback("error")}})},_callback:function(e,t){var r=this,n=r.script,o=r.io;n&&(r.script=void 0,t||("error"!==e?o._ioReady(i,"success"):"error"===e&&o._ioReady(s,"script error")))},abort:function(){this._callback(0,1)}}),a.setupTransport("script",r),t}(),s=function(e){var t=h,r=o,n=window;return r.setupConfig({jsonp:"callback",jsonpCallback:function(){return t.guid("jsonp")}}),r.addPreprocessor("start",function(e){var r=e.io,o=r.config,a=o.dataType;if("jsonp"===a[0]){delete o.contentType;var i,s,c=o.jsonpCallback,u="function"==typeof c?c():c,d=n[u];o.uri.query[o.jsonp]=u,n[u]=function(e){arguments.length>1&&(e=t.makeArray(arguments)),i=[e]},r.fin(function(){if(n[u]=d,void 0===d)try{delete n[u]}catch(e){}else i&&d(i[0])}),s=o.converters,s.script=s.script||{},s.script.json=function(){if(!i)throw new Error("not call jsonpCallback: "+u);return i[0]},a.length=2,a[0]="script",a[1]="json"}}),e}(),c=function(e){var t=h,r=o,a=y,i=g,s=n,c=window,u=Array.prototype.slice,d=c.FormData;return r.addPreprocessor("start",function(e){var r,n,o,c,p,l=e.io,f=l.config,m=f.form;if(m){r=a.get(m),p=f.data;for(var v=!1,h={},y=a.query("input",r),g=0,x=y.length;x>g;g++){var b=y[g];if("file"===b.type.toLowerCase()){if(v=!0,!d)break;var T=u.call(b.files,0);h[a.attr(b,"name")]=T.length>1?T:T[0]||null}}v&&d&&(f.files=f.files||{},t.mix(f.files,h),delete f.contentType),!v||d?(c=s.getFormData(r),f.hasContent?(c=i.stringify(c,void 0,void 0,f.serializeArray),p?f.data+="&"+c:f.data=c):t.mix(f.uri.query,c)):(o=f.dataType,n=o[0],"*"===n&&(n="text"),o.length=2,o[0]="iframe",o[1]=n)}}),e}(),u=function(e){function t(e){var t,r=s.guid("io-iframe"),n=d.getEmptyIframeSrc();return t=e.iframe=d.create("<iframe "+(n?' src="'+n+'" ':"")+' id="'+r+'" name="'+r+'" style="position:absolute;left:-9999px;top:-9999px;"/>'),d.prepend(t,l.body||l.documentElement),t}function r(e,t,r){var n,o,a,i=[];return s.each(e,function(e,c){for(n=s.isArray(e),n||(e=[e]),o=0;o<e.length;o++)a=l.createElement("input"),a.type="hidden",a.name=c+(n&&r?"[]":""),a.value=e[o],d.append(a,t),i.push(a)}),i}function n(e){d.remove(e)}function a(e){var t,r=this,o=r.form,a=r.io,i=e.type,u=a.iframe;if(u)if("abort"===i&&6===c.ie?setTimeout(function(){d.attr(o,r.attrs)},0):d.attr(o,r.attrs),n(this.fields),c.removeEvent(u,"load",r._callback),c.removeEvent(u,"error",r._callback),setTimeout(function(){d.remove(u)},x),a.iframe=null,"load"===i)try{t=u.contentWindow.document,t&&t.body&&(a.responseText=d.html(t.body),s.startsWith(a.responseText,"<?xml")&&(a.responseText=void 0)),a.responseXML=t&&t.XMLDocument?t.XMLDocument:t,t?a._ioReady(f,"success"):a._ioReady(m,"parser error")}catch(p){a._ioReady(m,"parser error")}else"error"===i&&a._ioReady(m,"error")}function i(e){this.io=e,this._callback=s.bind(a,this)}var s=h,c=v,u=g,d=y,p=o,l=document,f=200,m=500,x=30,b=s.clone(p.getConfig().converters.text);return b.json=function(e){return s.parseJson(s.unEscapeHtml(e))},p.setupConfig({converters:{iframe:b,text:{iframe:function(e){return e}},xml:{iframe:function(e){return e}}}}),s.augment(i,{send:function(){function e(){c.addEvent(o,"load",i._callback),c.addEvent(o,"error",i._callback),f.submit()}var n,o,a,i=this,s=i.io,p=s.config,l=p.data,f=d.get(p.form);i.attrs={target:d.attr(f,"target")||"",action:d.attr(f,"action")||"",encoding:d.attr(f,"encoding"),enctype:d.attr(f,"enctype"),method:d.attr(f,"method")},i.form=f,o=t(s),d.attr(f,{target:o.id,action:s._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"}),l&&(a=u.parse(l)),a&&(n=r(a,f,p.serializeArray)),i.fields=n,6===c.ie?setTimeout(e,0):e()},abort:function(){this._callback({type:"abort"})}}),p.setupTransport("iframe",i),e}(),d=function(e){function t(e){var t,n,o,a=e.responseText,i=e.responseXML,s=e.config,c=s.converters,u=s.contents,d=s.dataType;if(a||i){for(n=e.mimeType||e.getResponseHeader("Content-Type");"*"===d[0];)d.shift();if(!d.length)for(t in u)if(u[t].test(n)){d[0]!==t&&d.unshift(t);break}d[0]=d[0]||"text";for(var p=0;p<d.length;p++){if("text"===d[p]&&void 0!==a){o=a;break}if("xml"===d[p]&&void 0!==i){o=i;break}}if(!o){var l={text:a,xml:i};r.each(["text","xml"],function(e){var t=d[0],r=c[e]&&c[e][t];return r&&l[e]?(d.unshift(e),o="text"===e?a:i,!1):void 0})}}for(var f=d[0],m=1;m<d.length;m++){t=d[m];var v=c[f]&&c[f][t];if(!v)throw new Error("no covert for "+f+" => "+t);o=v(o),f=t}e.responseData=o}var r=h,n=x,a=o,i=b,s=200,c=300,u=304,d=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;return r.extend(a,n,{setRequestHeader:function(e,t){var r=this;return r.requestHeaders[e]=t,r},getAllResponseHeaders:function(){var e=this;return 2===e.state?e.responseHeadersString:null},getResponseHeader:function(e){var t,r,n=this;if(e=e.toLowerCase(),2===n.state){if(!(r=n.responseHeaders))for(r=n.responseHeaders={};t=d.exec(n.responseHeadersString);)r[t[1].toLowerCase()]=t[2];t=r[e]}return void 0===t?null:t},overrideMimeType:function(e){var t=this;return t.state||(t.mimeType=e),t},abort:function(e){var t=this;return e=e||"abort",t.transport&&t.transport.abort(e),t._ioReady(0,e),t},getNativeXhr:function(){var e=this.transport;return e?e.nativeXhr:null},_ioReady:function(e,r){var n=this;if(2!==n.state){n.state=2,n.readyState=4;var o;if(e>=s&&c>e||e===u)if(e===u)r="not modified",o=!0;else try{t(n),r="success",o=!0}catch(i){r=i.message||"parser error"}else 0>e&&(e=0);n.status=e,n.statusText=r;var d,p=n.defer,l=n.config;(d=n.timeoutTimer)&&(clearTimeout(d),n.timeoutTimer=0);var f,m=o?"success":"error",v=[n.responseData,r,n],h=l.context,y={io:n};(f=l[m])&&f.apply(h,v),(f=l.complete)&&f.apply(h,v),a.fire(m,y),a.fire("complete",y),p[o?"resolve":"reject"](v)}},_getUrlForSend:function(){var e=this.config,t=e.uri,n=t.search||"";return delete t.search,n&&!r.isEmptyObject(t.query)&&(n="&"+n.substring(1)),i.stringify(t,e.serializeArray)+n}}),e}(),p=function(e){function t(e,t){try{return new(t||l).XMLHttpRequest}catch(r){}return void 0}function r(e,t){try{return new(t||l).ActiveXObject("Microsoft.XMLHTTP")}catch(r){}return void 0}function n(e){return f&&e instanceof f}function a(e){var t,r=e.ifModified;return r&&(t=e.uri,e.cache===!1&&(t=s.clone(t),delete t.query._ksTS),t=c.stringify(t)),t}var i,s=h,c=b,u=g,d=o,p=200,l=window,f=v.ieMode>7&&l.XDomainRequest,m=204,y=404,x=1223,T={proto:{}},_={},w={};return d.__lastModifiedCached=_,d.__eTagCached=w,T.nativeXhr=l.ActiveXObject?function(e,n){return!i&&e&&f?new f:!d.isLocal&&t(e,n)||r(e,n)}:t,i=T.supportCORS="withCredentials"in T.nativeXhr(),T.XDomainRequest_=f,s.mix(T.proto,{sendInternal:function(){var e,t,r,o,c=this,d=c.io,p=d.config,l=c.nativeXhr,f=p.files,m=f?"post":p.type,v=p.async,h=d.mimeType,y=d.requestHeaders||{},g=d._getUrlForSend(),x=a(p);x&&((r=_[x])&&(y["If-Modified-Since"]=r),(r=w[x])&&(y["If-None-Match"]=r)),(e=p.username)?l.open(m,g,v,e,p.password):l.open(m,g,v),t=p.xhrFields||{},"withCredentials"in t&&(i||delete t.withCredentials);for(o in t)try{l[o]=t[o]}catch(b){}h&&l.overrideMimeType&&l.overrideMimeType(h);var T=y["X-Requested-With"];if(T===!1&&delete y["X-Requested-With"],"undefined"!=typeof l.setRequestHeader)for(o in y)l.setRequestHeader(o,y[o]);var R=p.hasContent&&p.data||null;if(f){var E=R,k={};E&&(k=u.parse(E)),k=s.mix(k,f),R=new FormData,s.each(k,function(e,t){s.isArray(e)?s.each(e,function(e){R.append(t+(p.serializeArray?"[]":""),e)}):R.append(t,e)})}l.send(R),v&&4!==l.readyState?n(l)?(l.onload=function(){l.readyState=4,l.status=200,c._callback()},l.onerror=function(){l.readyState=4,l.status=500,c._callback()}):l.onreadystatechange=function(){c._callback()}:c._callback()},abort:function(){this._callback(0,1)},_callback:function(e,t){var r,o,i,c,u,l=this,f=l.nativeXhr,v=l.io,h=v.config;try{if(t||4===f.readyState)if(n(f)?(f.onerror=s.noop,f.onload=s.noop):f.onreadystatechange=s.noop,t)4!==f.readyState&&f.abort();else{r=a(h);var g=f.status;n(f)||(v.responseHeadersString=f.getAllResponseHeaders()),r&&(o=f.getResponseHeader("Last-Modified"),i=f.getResponseHeader("ETag"),o&&(_[r]=o),i&&(w[i]=i)),u=f.responseXML,u&&u.documentElement&&(v.responseXML=u);var b=v.responseText=f.responseText;if(h.files&&b){var T,R;-1!==(T=b.indexOf("<body>"))&&(R=b.lastIndexOf("</body>"),-1===R&&(R=b.length),b=b.slice(T+6,R)),v.responseText=s.unEscapeHtml(b)}try{c=f.statusText}catch(E){c=""}g||!d.isLocal||h.crossDomain?g===x&&(g=m):g=v.responseText?p:y,v._ioReady(g,c)}}catch(E){f.onreadystatechange=s.noop,t||v._ioReady(-1,E.message||"process error")}}}),e=T}(),l=function(e){function t(e){var t=this,o=e.config;t.io=e,o.crossDomain=!1,t._onLoad=n.bind(r,t)}function r(){var e=this,t=e.io.config,r=t.uri,n=r.hostname,a=d[n];a.ready=1,o.removeEvent(a.iframe,"load",e._onLoad),e.send()}var n=h,o=v,a=b,i=y,s=p,c="/sub_domain_proxy.html",u=document,d={};return n.augment(t,s.proto,{send:function(){var e,t,r=this,n=r.io.config,p=n.uri,l=p.hostname,f=d[l],m=c;return n.xdr&&n.xdr.subDomain&&n.xdr.subDomain.proxy&&(m=n.xdr.subDomain.proxy),f&&f.ready?(r.nativeXhr=s.nativeXhr(0,f.iframe.contentWindow),r.nativeXhr?r.sendInternal():console.error("io: document.domain not set correctly!"),void 0):(f?e=f.iframe:(f=d[l]={},e=f.iframe=u.createElement("iframe"),i.css(e,{position:"absolute",left:"-9999px",top:"-9999px"}),i.prepend(e,u.body||u.documentElement),t={},t.protocol=p.protocol,t.host=p.host,t.pathname=m,e.src=a.stringify(t)),o.addEvent(e,"load",r._onLoad),void 0)}}),e=t}(),f=function(e){function t(e){return d.domain&&n.endsWith(e,d.domain)}function r(e){var r,n=e.config,o=n.crossDomain,a=this,i=n.xdr||{},d=i.subDomain=i.subDomain||{};if(a.io=e,o&&!s.supportCORS){if(t(n.uri.hostname)&&d.proxy!==!1)return new u(e);if("flash"===String(i.use)||!f)return new c(e)}return r=a.nativeXhr=s.nativeXhr(o),a}var n=h,i=o,s=p,c=a,u=l,d=document,f=s.XDomainRequest_;return n.augment(r,s.proto,{send:function(){this.sendInternal()}}),i.setupTransport("*",r),e}(),m=function(t){function r(e,t,r,n,o){return"function"==typeof t&&(n=r,r=t,t=void 0),i({type:o||"get",url:e,data:t,complete:r,dataType:n})}var a=n,i=o,s=h;return s.mix(i,{version:"1.1.0",_swf:e.toUrl("./io.swf"),serialize:a.serialize,getFormData:a.getFormData,get:r,post:function(e,t,n,o){return"function"==typeof t&&(o=n,n=t,t=void 0),r(e,t,n,o,"post")},jsonp:function(e,t,n){return"function"==typeof t&&(n=t,t=void 0),r(e,t,n,"jsonp")},getScript:e.load,getJSON:function(e,t,n){return"function"==typeof t&&(n=t,t=void 0),r(e,t,n,"json")},upload:function(e,t,r,n,o){return"function"==typeof r&&(o=n,n=r,r=void 0),i({url:e,type:"post",dataType:o,form:t,data:r,complete:n})}}),t=i}(),r.exports=m});