modulex.add("io",["util","dom","querystring","event-custom","promise","url","ua","event-dom"],function(e,t,r){var n,o,a,i,s,c,u,d,p,f,l,m,h=e("util"),v=e("dom"),y=e("querystring"),g=e("event-custom"),x=e("promise"),T=e("url"),b=e("ua"),_=e("event-dom");n=function(e){function t(e){return e.replace(c,"\r\n")}function r(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r]);return t}var n,o=h,a=v,i=y,s=/^(?:select|textarea)/i,c=/\r?\n/g,u=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return n={serialize:function(e,t){return i.stringify(n.getFormData(e),void 0,void 0,t||!1)},getFormData:function(e){var n=[],i={};return o.each(a.query(e),function(e){var t=e.elements?r(e.elements):[e];n.push.apply(n,t)}),n=o.filter(n,function(e){return e.name&&!e.disabled&&(e.checked||s.test(e.nodeName)||u.test(e.type))}),o.each(n,function(e){var r,n=a.val(e);if(null!==n){if(n=o.isArray(n)?o.map(n,t):t(n),r=i[e.name],void 0===r)return i[e.name]=n,void 0;o.isArray(r)||(r=i[e.name]=[r]),r.push.apply(r,o.makeArray(n))}}),i}},e=n}(),o=function(e){function t(e){var t=e.context;delete e.context,e=n.mix(n.clone(b),e,{deep:!0}),e.context=t||e;var r,a,i=e.type,c=e.dataType;return a=e.uri=s.parse(s.resolve(f,e.url),!0),a.query={},"crossDomain"in e||(e.crossDomain=!(a.protocol===l.protocol&&a.host===l.host)),i=e.type=i.toUpperCase(),e.hasContent=!p.test(i),e.processData&&(r=e.data)&&"string"!=typeof r&&(e.data=o.stringify(r,void 0,void 0,e.serializeArray)),c=e.dataType=n.trim(c||"*").split(u),"cache"in e||!n.inArray(c[0],["script","jsonp"])||(e.cache=!1),e.hasContent||(e.data&&n.mix(a.query,o.parse(e.data)),e.cache===!1&&(a.query._ksTS=n.now()+"_"+n.guid())),e}function r(e){var o=this;if(!(o instanceof r))return new r(e);r.superclass.constructor.call(o),i.Defer(o),o.userConfig=e,e=t(e),n.mix(o,{responseData:null,config:e||{},timeoutTimer:null,responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null});var a,s;r.fire("start",{ajaxConfig:e,io:o}),a=v[e.dataType[0]]||v["*"],s=new a(o),o.transport=s,e.contentType&&o.setRequestHeader("Content-Type",e.contentType);var c,u=e.dataType[0],d=e.timeout,p=e.context,f=e.headers,l=e.accepts;o.setRequestHeader("Accept",u&&l[u]?l[u]+("*"===u?"":", */*; q=0.01"):l["*"]);for(c in f)o.setRequestHeader(c,f[c]);if(e.beforeSend&&e.beforeSend.call(p,o,e)===!1)return o;o.readyState=1,r.fire("send",{ajaxConfig:e,io:o}),e.async&&d>0&&(o.timeoutTimer=setTimeout(function(){o.abort("timeout")},1e3*d));try{o.state=1,s.send()}catch(m){o.state<2&&o._ioReady(-1,m.message||"send error")}return o}var n=h,o=y,a=g,i=x,s=T,c=/^(?:about|app|app\-storage|.+\-extension|file|widget):$/,u=/\s+/,d=function(e){return e},p=/^(?:GET|HEAD)$/,f=location.href,l=s.parse(f),m=c.test(l.protocol),v={},b={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:n.parseJson,html:d,text:d,xml:n.parseXML}},headers:{"X-Requested-With":"XMLHttpRequest"},contents:{xml:/xml/,html:/html/,json:/json/}};return b.converters.html=b.converters.text,n.mix(r,a.Target),n.mix(r,{isLocal:m,setupConfig:function(e){n.mix(b,e,{deep:!0})},setupTransport:function(e,t){v[e]=t},getTransport:function(e){return v[e]},getConfig:function(){return b}}),e=r}(),a=function(e){function t(e,t){try{return new(t||l).XMLHttpRequest}catch(r){}return void 0}function r(e,t){try{return new(t||l).ActiveXObject("Microsoft.XMLHTTP")}catch(r){}return void 0}function n(e){return m&&e instanceof m}function a(e){var t,r=e.ifModified;return r&&(t=e.uri,e.cache===!1&&(t=s.clone(t),delete t.query._ksTS),t=c.stringify(t)),t}var i,s=h,c=T,u=y,d=o,p=b,f=200,l=window,m=p.ieMode>7&&l.XDomainRequest,v=204,g=404,x=1223,_={proto:{}},w={},R={};return d.__lastModifiedCached=w,d.__eTagCached=R,_.nativeXhr=l.ActiveXObject?function(e,n){return!i&&e&&m?new m:!d.isLocal&&t(e,n)||r(e,n)}:t,i=_.supportCORS="withCredentials"in _.nativeXhr(),_.XDomainRequest_=m,s.mix(_.proto,{sendInternal:function(){var e,t,r,o,c=this,d=c.io,p=d.config,f=c.nativeXhr,l=p.files,m=l?"post":p.type,h=p.async,v=d.mimeType,y=d.requestHeaders||{},g=d._getUrlForSend(),x=a(p);x&&((r=w[x])&&(y["If-Modified-Since"]=r),(r=R[x])&&(y["If-None-Match"]=r)),(e=p.username)?f.open(m,g,h,e,p.password):f.open(m,g,h),t=p.xhrFields||{},"withCredentials"in t&&(i||delete t.withCredentials);for(o in t)try{f[o]=t[o]}catch(T){}v&&f.overrideMimeType&&f.overrideMimeType(v);var b=y["X-Requested-With"];if(b===!1&&delete y["X-Requested-With"],"undefined"!=typeof f.setRequestHeader)for(o in y)f.setRequestHeader(o,y[o]);var _=p.hasContent&&p.data||null;if(l){var j=_,C={};j&&(C=u.parse(j)),C=s.mix(C,l),_=new FormData,s.each(C,function(e,t){s.isArray(e)?s.each(e,function(e){_.append(t+(p.serializeArray?"[]":""),e)}):_.append(t,e)})}f.send(_),h&&4!==f.readyState?n(f)?(f.onload=function(){f.readyState=4,f.status=200,c._callback()},f.onerror=function(){f.readyState=4,f.status=500,c._callback()}):f.onreadystatechange=function(){c._callback()}:c._callback()},abort:function(){this._callback(0,1)},_callback:function(e,t){var r,o,i,c,u,p=this,l=p.nativeXhr,m=p.io,h=m.config;try{if(t||4===l.readyState)if(n(l)?(l.onerror=s.noop,l.onload=s.noop):l.onreadystatechange=s.noop,t)4!==l.readyState&&l.abort();else{r=a(h);var y=l.status;n(l)||(m.responseHeadersString=l.getAllResponseHeaders()),r&&(o=l.getResponseHeader("Last-Modified"),i=l.getResponseHeader("ETag"),o&&(w[r]=o),i&&(R[i]=i)),u=l.responseXML,u&&u.documentElement&&(m.responseXML=u);var T=m.responseText=l.responseText;if(h.files&&T){var b,_;-1!==(b=T.indexOf("<body>"))&&(_=T.lastIndexOf("</body>"),-1===_&&(_=T.length),T=T.slice(b+6,_)),m.responseText=s.unEscapeHtml(T)}try{c=l.statusText}catch(j){c=""}y||!d.isLocal||h.crossDomain?y===x&&(y=v):y=m.responseText?f:g,m._ioReady(y,c)}}catch(j){l.onreadystatechange=s.noop,t||m._ioReady(-1,j.message||"process error")}}}),e=_}(),i=function(e){function t(e,t,r){if(!p){p=!0;var n='<object id="'+u+'" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0"><param name="movie" value="'+e+'" /><param name="FlashVars" value="yid='+t+"&uid="+r+"&host="+f+'" /><param name="allowScriptAccess" value="always" /></object>',o=d.createElement("div");s.prepend(o,d.body||d.documentElement),o.innerHTML=n}}function r(e){this.io=e}var n,a=h,i=o,s=v,c={},u="io_swf",d=document,p=!1,f=a.guid("IO"+ +new Date);return window[f]=i,a.augment(r,{send:function(){var e=this,r=e.io,o=r.config,s=o.xdr||{};return s.src||(s.src=i._swf),t(s.src,1,1),n?(e._uid=a.guid(),c[e._uid]=e,n.send(r._getUrlForSend(),{id:e._uid,uid:e._uid,method:o.type,data:o.hasContent&&o.data||{}}),void 0):(setTimeout(function(){e.send()},200),void 0)},abort:function(){n.abort(this._uid)},_xdrResponse:function(e,t){var r,n,o=this,a=t.id,i=t.c,s=o.io;switch(i&&(n=i.responseText)&&(s.responseText=decodeURI(n)),e){case"success":r={status:200,statusText:"success"},delete c[a];break;case"abort":delete c[a];break;case"timeout":case"transport error":case"failure":delete c[a],r={status:"status"in i?i.status:500,statusText:i.statusText||e}}r&&s._ioReady(r.status,r.statusText)}}),i.applyTo=function(e,t,r){var n=t.split(".").slice(1),o=i;a.each(n,function(e){o=o[e]}),o.apply(null,r)},i.xdrReady=function(){n=d.getElementById(u)},i.xdrResponse=function(e,t){var r=c[t.uid];r&&r._xdrResponse(e,t)},e=r}(),s=function(e){function t(e){var t=this,r=e.config;t.io=e,r.crossDomain=!1}function r(){var e=this,t=e.io.config,n=t.uri,a=n.hostname,i=p[a];i.ready=1,o.detach(i.iframe,"load",r,e),e.send()}var n=h,o=_,i=T,s=v,c=a,u="/sub_domain_proxy.html",d=document,p={};return n.augment(t,c.proto,{send:function(){var e,t,n=this,a=n.io.config,f=a.uri,l=f.hostname,m=p[l],h=u;return a.xdr&&a.xdr.subDomain&&a.xdr.subDomain.proxy&&(h=a.xdr.subDomain.proxy),m&&m.ready?(n.nativeXhr=c.nativeXhr(0,m.iframe.contentWindow),n.nativeXhr?n.sendInternal():console.error("io: document.domain not set correctly!"),void 0):(m?e=m.iframe:(m=p[l]={},e=m.iframe=d.createElement("iframe"),s.css(e,{position:"absolute",left:"-9999px",top:"-9999px"}),s.prepend(e,d.body||d.documentElement),t={},t.protocol=f.protocol,t.host=f.host,t.pathname=h,e.src=i.stringify(t)),o.on(e,"load",r,n),void 0)}}),e=t}(),c=function(t){function r(e){var t=e.config,r=this;return t.crossDomain?(r.io=e,r):new(a.getTransport("*"))(e)}var n=h,a=o,i=200,s=500;return a.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(e){return n.globalEval(e),e}}}}),n.augment(r,{send:function(){var t=this,r=t.io,n=r.config;t.script=e.load(r._getUrlForSend(),{charset:n.scriptCharset,success:function(){t._callback("success")},error:function(){t._callback("error")}})},_callback:function(e,t){var r=this,n=r.script,o=r.io;n&&(r.script=void 0,t||("error"!==e?o._ioReady(i,"success"):"error"===e&&o._ioReady(s,"script error")))},abort:function(){this._callback(0,1)}}),a.setupTransport("script",r),t}(),u=function(e){var t=h,r=o,n=window;return r.setupConfig({jsonp:"callback",jsonpCallback:function(){return t.guid("jsonp")}}),r.on("start",function(e){var r=e.io,o=r.config,a=o.dataType;if("jsonp"===a[0]){delete o.contentType;var i,s,c=o.jsonpCallback,u="function"==typeof c?c():c,d=n[u];o.uri.query[o.jsonp]=u,n[u]=function(e){arguments.length>1&&(e=t.makeArray(arguments)),i=[e]},r.fin(function(){if(n[u]=d,void 0===d)try{delete n[u]}catch(e){}else i&&d(i[0])}),s=o.converters,s.script=s.script||{},s.script.json=function(){if(!i)throw new Error("not call jsonpCallback: "+u);return i[0]},a.length=2,a[0]="script",a[1]="json"}}),e}(),d=function(e){var t=h,r=o,a=v,i=y,s=n,c=window,u=Array.prototype.slice,d=c.FormData;return r.on("start",function(e){var r,n,o,c,p,f=e.io,l=f.config,m=l.form;if(m){r=a.get(m),p=l.data;for(var h=!1,v={},y=a.query("input",r),g=0,x=y.length;x>g;g++){var T=y[g];if("file"===T.type.toLowerCase()){if(h=!0,!d)break;var b=u.call(T.files,0);v[a.attr(T,"name")]=b.length>1?b:b[0]||null}}h&&d&&(l.files=l.files||{},t.mix(l.files,v),delete l.contentType),!h||d?(c=s.getFormData(r),l.hasContent?(c=i.stringify(c,void 0,void 0,l.serializeArray),p?l.data+="&"+c:l.data=c):t.mix(l.uri.query,c)):(o=l.dataType,n=o[0],"*"===n&&(n="text"),o.length=2,o[0]="iframe",o[1]=n)}}),e}(),p=function(e){function t(e){var t,r=i.guid("io-iframe"),n=c.getEmptyIframeSrc();return t=e.iframe=c.create("<iframe "+(n?' src="'+n+'" ':"")+' id="'+r+'" name="'+r+'" style="position:absolute;left:-9999px;top:-9999px;"/>'),c.prepend(t,f.body||f.documentElement),t}function r(e,t,r){var n,o,a,s=[];return i.each(e,function(e,u){for(n=i.isArray(e),n||(e=[e]),o=0;o<e.length;o++)a=f.createElement("input"),a.type="hidden",a.name=u+(n&&r?"[]":""),a.value=e[o],c.append(a,t),s.push(a)}),s}function n(e){c.remove(e)}function a(e){this.io=e}var i=h,s=y,c=v,u=o,d=_,p=b,f=document,l=200,m=500,g=30,x=i.clone(u.getConfig().converters.text);return x.json=function(e){return i.parseJson(i.unEscapeHtml(e))},u.setupConfig({converters:{iframe:x,text:{iframe:function(e){return e}},xml:{iframe:function(e){return e}}}}),i.augment(a,{send:function(){function e(){d.on(o,"load error",i._callback,i),m.submit()}var n,o,a,i=this,u=i.io,f=u.config,l=f.data,m=c.get(f.form);i.attrs={target:c.attr(m,"target")||"",action:c.attr(m,"action")||"",encoding:c.attr(m,"encoding"),enctype:c.attr(m,"enctype"),method:c.attr(m,"method")},i.form=m,o=t(u),c.attr(m,{target:o.id,action:u._getUrlForSend(),method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"}),l&&(a=s.parse(l)),a&&(n=r(a,m,f.serializeArray)),i.fields=n,6===p.ie?setTimeout(e,0):e()},_callback:function(e){var t,r=this,o=r.form,a=r.io,s=e.type,u=a.iframe;if(u)if("abort"===s&&6===p.ie?setTimeout(function(){c.attr(o,r.attrs)},0):c.attr(o,r.attrs),n(this.fields),d.detach(u),setTimeout(function(){c.remove(u)},g),a.iframe=null,"load"===s)try{t=u.contentWindow.document,t&&t.body&&(a.responseText=c.html(t.body),i.startsWith(a.responseText,"<?xml")&&(a.responseText=void 0)),a.responseXML=t&&t.XMLDocument?t.XMLDocument:t,t?a._ioReady(l,"success"):a._ioReady(m,"parser error")}catch(f){a._ioReady(m,"parser error")}else"error"===s&&a._ioReady(m,"error")},abort:function(){this._callback({type:"abort"})}}),u.setupTransport("iframe",a),e}(),f=function(e){function t(e){var t,n,o,a=e.responseText,i=e.responseXML,s=e.config,c=s.converters,u=s.contents,d=s.dataType;if(a||i){for(n=e.mimeType||e.getResponseHeader("Content-Type");"*"===d[0];)d.shift();if(!d.length)for(t in u)if(u[t].test(n)){d[0]!==t&&d.unshift(t);break}d[0]=d[0]||"text";for(var p=0;p<d.length;p++){if("text"===d[p]&&void 0!==a){o=a;break}if("xml"===d[p]&&void 0!==i){o=i;break}}if(!o){var f={text:a,xml:i};r.each(["text","xml"],function(e){var t=d[0],r=c[e]&&c[e][t];return r&&f[e]?(d.unshift(e),o="text"===e?a:i,!1):void 0})}}for(var l=d[0],m=1;m<d.length;m++){t=d[m];var h=c[l]&&c[l][t];if(!h)throw new Error("no covert for "+l+" => "+t);o=h(o),l=t}e.responseData=o}var r=h,n=x,a=o,i=T,s=200,c=300,u=304,d=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm;return r.extend(a,n,{setRequestHeader:function(e,t){var r=this;return r.requestHeaders[e]=t,r},getAllResponseHeaders:function(){var e=this;return 2===e.state?e.responseHeadersString:null},getResponseHeader:function(e){var t,r,n=this;if(e=e.toLowerCase(),2===n.state){if(!(r=n.responseHeaders))for(r=n.responseHeaders={};t=d.exec(n.responseHeadersString);)r[t[1].toLowerCase()]=t[2];t=r[e]}return void 0===t?null:t},overrideMimeType:function(e){var t=this;return t.state||(t.mimeType=e),t},abort:function(e){var t=this;return e=e||"abort",t.transport&&t.transport.abort(e),t._ioReady(0,e),t},getNativeXhr:function(){var e=this.transport;return e?e.nativeXhr:null},_ioReady:function(e,r){var n=this;if(2!==n.state){n.state=2,n.readyState=4;var o;if(e>=s&&c>e||e===u)if(e===u)r="not modified",o=!0;else try{t(n),r="success",o=!0}catch(i){r=i.message||"parser error"}else 0>e&&(e=0);n.status=e,n.statusText=r;var d,p=n.defer,f=n.config;(d=n.timeoutTimer)&&(clearTimeout(d),n.timeoutTimer=0);var l,m=o?"success":"error",h=[n.responseData,r,n],v=f.context,y={ajaxConfig:f,io:n};(l=f[m])&&l.apply(v,h),(l=f.complete)&&l.apply(v,h),a.fire(m,y),a.fire("complete",y),p[o?"resolve":"reject"](h)}},_getUrlForSend:function(){var e=this.config,t=e.uri,n=t.search||"";return delete t.search,n&&!r.isEmptyObject(t.query)&&(n="&"+n.substring(1)),i.stringify(t,e.serializeArray)+n}}),e}(),l=function(e){function t(e){return f.domain&&n.endsWith(e,f.domain)}function r(e){var r,n=e.config,o=n.crossDomain,a=this,i=n.xdr||{},s=i.subDomain=i.subDomain||{};if(a.io=e,o&&!u.supportCORS){if(t(n.uri.hostname)&&s.proxy!==!1)return new p(e);if("flash"===String(i.use)||!l)return new d(e)}return r=a.nativeXhr=u.nativeXhr(o),a}var n=h,c=o,u=a,d=i,p=s,f=document,l=u.XDomainRequest_;return n.augment(r,u.proto,{send:function(){this.sendInternal()}}),c.setupTransport("*",r),e}(),m=function(t){function r(e,t,r,n,o){return"function"==typeof t&&(n=r,r=t,t=void 0),i({type:o||"get",url:e,data:t,complete:r,dataType:n})}var a=n,i=o,s=h;return s.mix(i,{version:"1.0.1",_swf:e.toUrl("./io.swf"),serialize:a.serialize,getFormData:a.getFormData,get:r,post:function(e,t,n,o){return"function"==typeof t&&(o=n,n=t,t=void 0),r(e,t,n,o,"post")},jsonp:function(e,t,n){return"function"==typeof t&&(n=t,t=void 0),r(e,t,n,"jsonp")},getScript:e.load,getJSON:function(e,t,n){return"function"==typeof t&&(n=t,t=void 0),r(e,t,n,"json")},upload:function(e,t,r,n,o){return"function"==typeof r&&(o=n,n=r,r=void 0),i({url:e,type:"post",dataType:o,form:t,data:r,complete:n})}}),t=i}(),r.exports=m});